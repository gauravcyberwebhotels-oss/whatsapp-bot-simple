<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Messenger Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body,html{height:100%}*,*:before,*:after{box-sizing:border-box}body{font-family:Segoe UI,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);margin:0;display:flex;align-items:center;justify-content:center;padding:20px}.container{max-width:1100px;width:100%;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.2);overflow:hidden}.header{background:linear-gradient(135deg,#1f2937,#374151);color:#fff;padding:40px 30px;text-align:center;position:relative}.main-content{display:grid;grid-template-columns:1fr 1fr;gap:30px;padding:30px}@media (max-width:900px){.main-content{grid-template-columns:1fr}}.panel{background:#f8fafc;border-radius:15px;padding:25px}h1,h2{margin:0 0 10px 0}h2{font-size:1.5rem}.form-group{margin-bottom:15px}label{display:block;font-weight:600;margin-bottom:5px}input{width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;font-size:1rem}.btn{padding:12px 25px;width:100%;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:transform .2s,box-shadow .2s}.btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.btn-secondary{background:#6b7280;color:#fff}.status-container{margin-top:15px;min-height:50px}.status{padding:15px;border-radius:10px;text-align:center;font-weight:600;animation:fadeIn .3s ease}.status-success{background:#d1fae5;color:#065f46}.status-error{background:#fee2e2;color:#b91c1c}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.user-info .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px}.info-label{font-size:.9rem;color:#4b5563}.info-value{font-weight:600;word-break:break-all;margin-top:2px}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.6);align-items:center;justify-content:center}.loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:2000}.spinner{border:5px solid #f3f3f3;border-top:5px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.logout-btn{position:absolute;top:20px;right:20px;background:#ef4444;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer}</style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div></div>
    <div class="container">
        <header class="header">
            <h1><i class="fab fa-whatsapp"></i> WhatsApp Messenger Pro</h1>
            <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display:none;"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </header>
        <main class="main-content">
            <section class="panel">
                <div id="authSection">
                    <div id="loginForm">
                        <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
                        <div class="form-group"><label for="loginEmail">Email</label><input type="email" id="loginEmail" required></div>
                        <div class="form-group"><label for="loginPassword">Password</label><input type="password" id="loginPassword" required></div>
                        <button class="btn btn-primary" onclick="handleLogin()">Login</button>
                        <p style="text-align:center;margin-top:15px;"><a href="#" onclick="showForgotPasswordModal()">Forgot Password?</a> | <a href="#" onclick="showRegister()">Create Account</a></p>
                    </div>
                    <div id="registerForm" style="display:none">
                        <h2><i class="fas fa-user-plus"></i> Register</h2>
                        <div class="form-group"><label for="registerEmail">Email</label><input type="email" id="registerEmail" required></div>
                        <div class="form-group"><label for="registerPassword">Password (min 8)</label><input type="password" id="registerPassword" required></div>
                        <div class="form-group"><label for="registerConfirmPassword">Confirm</label><input type="password" id="registerConfirmPassword" required></div>
                        <button class="btn btn-primary" onclick="handleRegister()">Create Account</button>
                        <p style="text-align:center;margin-top:15px;">Already have an account? <a href="#" onclick="showLogin()">Login here</a></p>
                    </div>
                </div>
                <div id="dashboardSection" class="user-info" style="display:none">
                    <h2><i class="fas fa-rocket"></i> Your Dashboard</h2>
                    <div class="info-grid">
                        <div><div class="info-label">Email</div><div class="info-value" id="userEmail"></div></div>
                        <div><div class="info-label">Last Login</div><div class="info-value" id="userLastLogin"></div></div>
                        <div style="grid-column:1/-1"><div class="info-label">Spreadsheet URL</div><div class="info-value" id="spreadsheetStatus"></div></div>
                    </div>
                    <div class="form-group">
                        <label for="spreadsheetUrl">Update Google Sheet URL</label>
                        <input type="url" id="spreadsheetUrl" placeholder="https://docs.google.com/spreadsheets/...">
                    </div>
                    <button class="btn btn-primary" onclick="handleSaveSpreadsheet()">Save URL</button>
                </div>
                <div class="status-container"><div id="status"></div></div>
            </section>
            <aside class="panel">
                <h2><i class="fas fa-info-circle"></i> Instructions</h2>
                <ol style="padding-left:20px;line-height:1.7">
                    <li><b>Register & Login:</b> Access your secure dashboard.</li>
                    <li><b>Save URL:</b> Your Google Sheet URL is saved permanently.</li>
                    <li><b>Password Reset:</b> An email with a reset code will be sent to your account's email address via Brevo API.</li>
                </ol>
            </aside>
        </main>
    </div>
    <div class="modal" id="forgotPasswordModal">
        <div class="modal-content">
            <h2><i class="fas fa-key"></i> Reset Password</h2>
            <div class="form-group"><label for="forgotEmail">Your Account Email</label><input type="email" id="forgotEmail" required></div>
            <button class="btn btn-primary" onclick="handleForgotPassword()">Send Reset Code</button>
            <button class="btn btn-secondary" style="margin-top:10px" onclick="hideModals()">Cancel</button>
        </div>
    </div>
    <div class="modal" id="resetPasswordModal">
        <div class="modal-content">
            <h2><i class="fas fa-lock"></i> Set New Password</h2>
            <div class="form-group"><label for="resetCode">6-Digit Code</label><input type="text" id="resetCode" maxlength="6" required></div>
            <div class="form-group"><label for="newPassword">New Password</label><input type="password" id="newPassword" required></div>
            <div class="form-group"><label for="confirmNewPassword">Confirm</label><input type="password" id="confirmNewPassword" required></div>
            <button class="btn btn-primary" onclick="handleResetPassword()">Reset Password</button>
            <button class="btn btn-secondary" style="margin-top:10px" onclick="hideModals()">Cancel</button>
        </div>
    </div>
<script>
    let userSecretKey='',userEmail='',resetEmail='';
    const loading=document.getElementById('loadingOverlay'),statusDiv=document.getElementById('status');
    function showStatus(m,t='error'){statusDiv.textContent=m;statusDiv.className=`status status-${t}`;statusDiv.style.display='block';setTimeout(()=>{statusDiv.style.display='none'},5000)}
    async function apiRequest(e,o={}){loading.style.display='flex';try{const r=await fetch(e,{headers:{'Content-Type':'application/json',...o.headers},...o}),j=await r.json();if(!r.ok)throw new Error(j.error||`Server Error ${r.status}`);return j}catch(e){showStatus(e.message,'error')}finally{loading.style.display='none'}}
    async function handleRegister(){const e=document.getElementById('registerEmail').value,p=document.getElementById('registerPassword').value;if(p!==document.getElementById('registerConfirmPassword').value)return showStatus('Passwords do not match.');if(p.length<8)return showStatus('Password must be at least 8 characters.');const r=await apiRequest('/register',{method:'POST',body:JSON.stringify({email:e,password:p})});r&&showStatus(r.message,'success')&&showLogin()}
    async function handleLogin(){const e=document.getElementById('loginEmail').value,p=document.getElementById('loginPassword').value,r=await apiRequest('/login',{method:'POST',body:JSON.stringify({email:e,password:p})});r&&(userEmail=e,userSecretKey=r.secret_key,showDashboard(r),showStatus('Login successful!','success'))}
    async function handleSaveSpreadsheet(){const s=document.getElementById('spreadsheetUrl').value;if(!s.startsWith('https://docs.google.com/spreadsheets/'))return showStatus('Invalid Google Sheet URL.');const r=await apiRequest('/save_spreadsheet',{method:'POST',body:JSON.stringify({secret_key:userSecretKey,spreadsheet_url:s})});r&&(showStatus(r.message,'success'),document.getElementById('spreadsheetStatus').textContent=`âœ… ${s}`)}
    async function handleForgotPassword(){const e=document.getElementById('forgotEmail').value;if(!e)return showStatus('Please enter an email.');resetEmail=e;const r=await apiRequest('/forgot_password',{method:'POST',body:JSON.stringify({email:e})});r&&(showStatus(r.message,'success'),hideModals(),document.getElementById('resetPasswordModal').style.display='flex')}
    async function handleResetPassword(){const e=document.getElementById('resetCode').value,n=document.getElementById('newPassword').value;if(n!==document.getElementById('confirmNewPassword').value)return showStatus("Passwords do not match.");const r=await apiRequest('/reset_password',{method:'POST',body:JSON.stringify({email:resetEmail,code:e,new_password:n})});r&&(showStatus(r.message,'success'),hideModals(),showLogin())}
    function showDashboard(d){document.getElementById('authSection').style.display='none';document.getElementById('dashboardSection').style.display='block';document.getElementById('logoutBtn').style.display='block';document.getElementById('userEmail').textContent=userEmail;const l=document.getElementById('userLastLogin');d.last_login_at?l.textContent=new Date(d.last_login_at).toLocaleString():l.textContent='Welcome!';const s=d.spreadsheet_url;document.getElementById('spreadsheetStatus').textContent=s?`âœ… ${s}`:'ðŸŸ¡ No URL saved.';if(s)document.getElementById('spreadsheetUrl').value=s;}
    function logout(){userSecretKey=userEmail=resetEmail='';document.getElementById('dashboardSection').style.display='none';document.getElementById('logoutBtn').style.display='none';document.getElementById('authSection').style.display='block';showLogin();showStatus('Logged out successfully.','success')}
    function hideModals(){document.querySelectorAll('.modal').forEach(m=>m.style.display='none')}
    function showForgotPasswordModal(){hideModals();document.getElementById('forgotPasswordModal').style.display='flex'}
    function showLogin(){document.getElementById('registerForm').style.display='none';document.getElementById('loginForm').style.display='block';hideModals()}
    function showRegister(){document.getElementById('loginForm').style.display='none';document.getElementById('registerForm').style.display='block';hideModals()}
</script>
</body>
</html>
